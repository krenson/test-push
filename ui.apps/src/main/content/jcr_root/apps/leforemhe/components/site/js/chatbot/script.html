<sly data-sly-template.script="${@ properties}">
<script>
var Loader = function () { }
Loader.prototype = {
    require: function (scripts, callback) {
        this.loadCount      = 0;
        this.totalRequired  = scripts.length;
        this.callback       = callback;

        for (var i = 0; i < scripts.length; i++) {
            this.writeScript(scripts[i]);
        }
    },
    loaded: function (evt) {
        this.loadCount++;

        if (this.loadCount == this.totalRequired && typeof this.callback == 'function') this.callback.call();
    },
    writeScript: function (src) {
        var self = this;
        var s = document.createElement('script');
        s.type = "text/javascript";
        s.async = true;
        s.src = src;
        s.addEventListener('load', function (e) { self.loaded(e); }, false);
        var head = document.getElementsByTagName('head')[0];
        head.appendChild(s);
    }
}

const findFirstSubstring = (regexForIdp, listInArray) => {
    const regex = new RegExp(regexForIdp);
    for (let value of listInArray) {
        if (regex.test(value)) {
            return true;
    }
  }
  return false;
}

var l = new Loader();

const urls = "${properties.listUrlChatbot @ context='uri'}";

if (urls.trim()) {
    var currentPage = window.location.toString();
    var listUrls = urls.split(',');
    var idp = /\/idp\//;
    var idpEntr = /\/entreprise-idp\//;

    if (listUrls.includes(currentPage) || (currentPage.search(idp) >= 0 && findFirstSubstring(idp, listUrls) == true)
        || (currentPage.search(idpEntr) >= 0 && findFirstSubstring(idpEntr, listUrls) == true) ){
        l.require(["${properties.urlChatbot @ context='uri'}"],
            function() {
                // Callback
                console.log('All Scripts Loaded');
        });
    }
}
</script>


</sly>




